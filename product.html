<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/product.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <title>Document</title>
</head>
<body>
    <div class="product-container">
        <div class="product-main">
            <img src="" id="mainImage" alt="">
        </div>

        <div class="product-gallery" id="gallery"></div>

        <div class="product-info">
            <h2 id="name"></h2>
            <span class="price" id="price"></span>
            <p class="category">ุฏุณุชูโุจูุฏ: <span id="category"></span></p>
            <p class="description"></p>

            <div class="buttons">
                <button id="addToCart">ุฎุฑุฏ ูุญุตูู ๐</button>
                <div id="addTofavorite" class="favorite-btn">
                    <i class="fas fa-heart"></i>
                </div>
            </div>
        </div>
    </div>

    <section class="related-products">
        <h3>ูุญุตููุงุช ูุฑุชุจุท</h3>
        <div class="related-container" id="relatedProducts"></div>
    </section>

    <footer>
        <div class="row">
            <div class="col-lg-8">
                <div class="right">
                    <div class="title">
                        ุฏุฑุจุงุฑู ูุง
                    </div>
                    <div class="des">
                        Carhartt WIP | ุงุตุงูุช ุดูุฑุ ฺฉูุช ุจโฺููโูฺุฑุง
<br>ูุง ุงูุฌุง ูุณุชู ุชุง ูุจุงุณโูุง ู ุงฺฉุณุณูุฑโูุง ุงุฑุงุฆู ุจุฏู ฺฉู ููโุชููุง ุฑุงุญุช ู ุจุง ุฏูุงู ูุณุชูุ ุจูฺฉู ุณุจฺฉ ุฒูุฏฺฏ ู ุดุฎุตุช ุดูุง ุฑู ูู ุชุนุฑู ูโฺฉูู. ูุฑ ูุทุนู ฺฉุงุฑูุงุฑุช ุจุง ุฏูุช ุทุฑุงุญ ุดุฏู ุชุง ุฏุฑ ุฎุงุจููโูุง ุดูุฑ ู ูุญุทโูุง ฺฉุงุฑ ุณุฎุชุ ููุฑุงู ุดูุง ุจุงุดู.
ุจุง ูุง ุชุฌุฑุจูโุง ุงุฒ ุงุณุชุงู ุงุตู ุดูุฑ ุฏุงุดุชู ุจุงุดู: ุงุฒ ฺฉุงูพุดูโูุง ู ุฌูููโูุง ููุงูู ฺฏุฑูุชู ุชุง ุดููุงุฑูุง ู ุงฺฉุณุณูุฑโูุง ุฎูู ฺฉู ูุฑ ุฑูุฒุชูู ุฑู ุฑุงุญุชโุชุฑ ู ุฌุฐุงุจโุชุฑ ูโฺฉูู. ฺฉูุชุ ุฌุฒุฆุงุช ู ุฏูุงูุ ููุดู ุฏุฑ ุงูููุช ูุงุณุช.<br>
๐ฆ ุงุฑุณุงู ุณุฑุน ู ูุทูุฆู
<br>
๐ ูพุฑุฏุงุฎุช ุงูู ู ุขุณุงู
<br>
โญ ฺฉูุช ุชุถูู ู ุงุตุงูุช ุจุฑูุฏ
<br>

ุจู ุฌูุน ฺฉุงุฑูุงุฑุช WIP ุจูพููุฏุฏ ู ุณุจฺฉ ุฎูุฏุชูู ุฑู ุจู ููู ูุดูู ุจุฏุฏ!
                    </div>
                </div>   
            </div>
            <div class="col-lg-4">
                <div class="left">
                    <div class="title">
                        ูุง ุฑุง ุฏุฑ ุดุจฺฉู ูุง ุงุฌุชูุงุน ุฏูุจุงู ฺฉูุฏ :
                    </div>
                    <div class="socials">
                        <a href=""><i class="fab fa-twitter"></i></a>
                        <a href=""><i class="fab fa-instagram"></i></a>
                        <a href=""><i class="fab fa-linkedin"></i></a>
                        <a href=""><i class="fab fa-telegram-plane"></i></a>
                    </div>
                </div>
            </div>
        </div>
        <div class="bottom">
                ฺฉูู ุญููู ูุญููุธ ู ุจุงุดุฏ 2025 ยฉ
        </div>
    </footer>
    <script type="module">
        import products from "./js/constants/product.js";
        import superOfferProducts from "./js/constants/supperOfferProduct.js";
        import otherProducts from "./js/constants/otherProducts.js";

const allProducts = [...products, ...superOfferProducts, ...otherProducts];

const params = new URLSearchParams(window.location.search);
const productId = params.get("id");

const product = allProducts.find(p => String(p.id) === String(productId));

if (!product) {
    document.body.innerHTML = "<p style='text-align:center;'>ูุญุตูู ุงูุช ูุดุฏ โ</p>";
} else {
    document.getElementById("mainImage").src = product.mainImage;
    document.getElementById("name").textContent = product.name;
    document.getElementById("price").textContent = product.price.toLocaleString();
    document.getElementById("category").textContent = product.category || "ูุงูุดุฎุต";
    document.querySelector(".description").textContent = product.description || "";

    const galleryEl = document.getElementById("gallery");

const thumbnails = [
  product.mainImage,
  ...(Array.isArray(product.gallery)
    ? product.gallery.filter(img => img !== product.mainImage)
    : [])
];

galleryEl.innerHTML = thumbnails
  .map((img, idx) => `
    <img 
      src="${img}" 
      alt="${product.name}" 
      class="thumb ${idx === 0 ? 'active' : ''}" 
      data-src="${img}">
  `)
  .join("");

  let startX = 0;
let currentIndex = 0;

const mainImageEl = document.getElementById("mainImage");

mainImageEl.addEventListener("touchstart", (e) => {
  startX = e.touches[0].clientX;
});

mainImageEl.addEventListener("touchend", (e) => {
  const endX = e.changedTouches[0].clientX;
  const diffX = startX - endX;

  if (Math.abs(diffX) > 50) {
    if (diffX > 0) {
      currentIndex = (currentIndex + 1) % thumbnails.length;
    } else {
      currentIndex = (currentIndex - 1 + thumbnails.length) % thumbnails.length;
    }

    const newSrc = thumbnails[currentIndex];
    mainImageEl.src = newSrc;

    galleryEl.querySelectorAll(".thumb").forEach(t => t.classList.remove("active"));
    const activeThumb = galleryEl.querySelector(`.thumb[data-src="${newSrc}"]`);
    if (activeThumb) activeThumb.classList.add("active");
  }
});

galleryEl.querySelectorAll(".thumb").forEach(thumb => {
  thumb.addEventListener("click", () => {
    const src = thumb.dataset.src;
    document.getElementById("mainImage").src = src;

    galleryEl.querySelectorAll(".thumb").forEach(t => t.classList.remove("active"));
    thumb.classList.add("active");
  });
});


    document.getElementById("addToCart").addEventListener("click", () => {
        addToCart(product.id, product.price, product.name, product.mainImage, product.gallery);
    });

    const favBtn = document.getElementById("addTofavorite");
    favBtn.addEventListener("click", () => {
        addTofavorite(favBtn, product.id, product.price, product.name, product.mainImage, product.gallery);
    });

    const loggedInUser = JSON.parse(localStorage.getItem("logged-in"))?.username;
    if (loggedInUser) {
        const userData = JSON.parse(localStorage.getItem(loggedInUser));
        const isFav = userData?.favorites?.some(p => String(p.id) === String(product.id));
        if (isFav) {
            favBtn.classList.add("active");
            favBtn.querySelector("i").style.color = "#ff4d4d";
            favBtn.querySelector("i").style.webkitTextStroke = "0";
        }
    }
}

function addTofavorite(element, id, price, name, mainImage, gallery = []) {
    const loggedInUser = JSON.parse(localStorage.getItem("logged-in"))?.username;
    if (!loggedInUser) {
        alert("ุงุจุชุฏุง ูุงุฑุฏ ุญุณุงุจ ฺฉุงุฑุจุฑ ุฎูุฏ ุดูุฏ!");
        window.location.href = "login.html";
        return;
    }

    const userData = JSON.parse(localStorage.getItem(loggedInUser)) || {
        username: loggedInUser,
        cart: [],
        favorites: []
    };

    if (!Array.isArray(userData.favorites)) {
        userData.favorites = [];
    }

    const idx = userData.favorites.findIndex(p => String(p.id) === String(id));
    const icon = element.querySelector("i");

    if (idx !== -1) {
        userData.favorites.splice(idx, 1);
        element.classList.remove("active");
        if (icon) {
            icon.style.color = "#fff";
            icon.style.webkitTextStroke = "1.5px black";
        }
    } else {
        userData.favorites.push({ id, price, name, mainImage, gallery });
        element.classList.add("active");
        if (icon) {
            icon.style.color = "#ff4d4d";
            icon.style.webkitTextStroke = "0";
        }
    }

    localStorage.setItem(loggedInUser, JSON.stringify(userData));
}

function addToCart(id, price, name, mainImage, gallery) {
    const username = JSON.parse(localStorage.getItem("logged-in"))?.username;
    if (!username) {
        alert("ุงุจุชุฏุง ูุงุฑุฏ ุญุณุงุจ ฺฉุงุฑุจุฑ ุฎูุฏ ุดูุฏ!");
        return;
    }

    const userData = JSON.parse(localStorage.getItem(username)) || { username, cart: [], favorites: [] };
    const cart = userData.cart || [];

    const doesProductExistInCart = cart.some((product) => id == product.id);

    if (doesProductExistInCart) {
        alert("ุงู ูุญุตูู ุฏุฑ ุณุจุฏ ุฎุฑุฏ ููุฌูุฏ ุงุณุช.");
    } else {
        cart.push({
            id,
            price,
            name,
            mainImage,
            gallery: Array.isArray(gallery) ? gallery : [],
        });

        userData.cart = cart;
        localStorage.setItem(username, JSON.stringify(userData));
        alert("ูุญุตูู ุจุง ููููุช ุจู ุณุจุฏ ุฎุฑุฏ ุงุถุงูู ุดุฏ.");
        location.reload();
    }
}

const relatedEl = document.getElementById("relatedProducts");

if (relatedEl && product.category) {
  const relatedProducts = allProducts
    .filter(p => p.category === product.category && p.id !== product.id)
    .slice(0, 4);
  if (relatedProducts.length > 0) {
    relatedEl.innerHTML = relatedProducts.map(p => `
      <div class="related-item" onclick="window.location.href='product.html?id=${p.id}'">
        <img src="${p.mainImage}" alt="${p.name}">
        <h4>${p.name}</h4>
        <span class="price">${p.price.toLocaleString()} ุชููุงู</span>
      </div>
    `).join("");
  } else {
    relatedEl.innerHTML = "<p style='text-align:center;'>ูุญุตูู ูุฑุชุจุท ุงูุช ูุดุฏ</p>";
  }
}



    </script>

</body>
</html>