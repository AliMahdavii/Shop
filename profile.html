<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/profile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <title>Document</title>
</head>
<body>
    <div class="profile-container">
        <div class="user-header">
            <i class="fa-solid fa-user-circle"></i>
            <h2 id="username">Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ</h2>
        </div>

        <div class="user-info">
            <p><strong>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ:</strong> <span id="user-name"></span> </p>
        </div>
        
        <div class="favorites">
            <h3 id="favorite-toggle">
                Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ù†
                <i class="fa-solid fa-chevron-down"></i>
            </h3>
            <div class="favorite-list" id="favorite-list"></div>
        </div>

        <button class="logout-btn" id="logout">Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø³Ø§Ø¨</button>

    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const loggedInUser = JSON.parse(localStorage.getItem("logged-in"))?.username;
            if(!loggedInUser){
                alert("Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø´ÙˆÛŒØ¯!");
                window.location.href = "login.html";
                return;
            }
            document.getElementById("username").textContent = `Ø³Ù„Ø§Ù…ØŒ ${loggedInUser}!`;
            document.getElementById("user-name").textContent = loggedInUser;

            const userData = JSON.parse(localStorage.getItem(loggedInUser)) || {};
            const favorites = userData.favorites || [];
            const favoriteList = document.getElementById("favorite-list");

            if(favorites.length === 0){
                favoriteList.innerHTML = "<p class='empty-message'>Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† Ù…Ø­ØµÙˆÙ„ÛŒ Ø¯Ø± Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ Ù†Ø¯Ø§Ø±ÛŒØ¯ ðŸ–¤</p>"
            } else {
                favoriteList.innerHTML = favorites.map(fav => 
                    `<div class="fav-item">
                        <img src="${fav.mainImage}">
                        <div class="fav-details">
                            <h4>${fav.name}</h4>    
                            <p>${fav.price.toLocaleString()} ØªÙˆÙ…Ø§Ù†</p>
                        </div>
                    </div>
                    `).join('');
            }

                document.getElementById("logout").addEventListener("click", () => {
                if(confirm("Ø¢ÛŒØ§ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ Ù…Ø·Ù…ÛŒÙ† Ù‡Ø³ØªÛŒØ¯ ØŸ")){
                    localStorage.removeItem("logged-in");
                    alert("Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø² Ø­Ø³Ø§Ø¨ Ø®Ø§Ø±Ø¬ Ø´Ø¯ÛŒØ¯.");
                window.location.href = "login.html";
                }
            });

            const favoritesSection = document.querySelector(".favorites");
            const toggleBtn = document.getElementById("favorite-toggle");

            toggleBtn.addEventListener("click", () => {
                favoritesSection.classList.toggle("open");
            });
        });
    </script>

</body>
</html>